{"version":3,"file":"js/7356.cbad4c4c.js","mappings":"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","sources":["webpack://aw-webui/./src/views/Trends.vue","webpack://aw-webui/./src/views/Trends.vue?271a","webpack://aw-webui/./src/views/Trends.vue?049e","webpack://aw-webui/./src/util/datasets.ts","webpack://aw-webui/./src/util/transforms.ts"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',[_c('h3',{staticClass:\"mb-0\"},[_vm._v(\"Trends for \"+_vm._s(_vm._f(\"friendlyperiod\")(_vm.timeperiod)))]),_c('b-input-group',{attrs:{\"size\":\"sm\"}},[_c('b-form-select',{attrs:{\"label\":\"Host\",\"options\":_vm.bucketsStore.hosts,\"placeholder\":\"Select a hostname\"},model:{value:(_vm.host),callback:function ($$v) {_vm.host=$$v},expression:\"host\"}})],1),_c('div',{staticClass:\"mb-2\"},[_c('ul',{staticClass:\"list-group list-group-horizontal-md mb-3\",staticStyle:{\"font-size\":\"0.9em\",\"opacity\":\"0.7\"}},[_c('li',{staticClass:\"list-group-item pl-0 pr-3 py-0 border-0\"},[_c('b',[_vm._v(\"Host:\")]),_vm._v(\" \"+_vm._s(_vm.host))])])]),_c('b-alert',{staticStyle:{},attrs:{\"show\":\"\"}},[_vm._v(\"This feature is still in early development.\")]),_c('div',[_c('aw-timeline-barchart',{attrs:{\"datasets\":_vm.datasets,\"height\":100}})],1),_c('div',[_c('hr'),_c('h5',[_vm._v(\"Options\")]),_c('aw-devonly',[_c('b-btn',{attrs:{\"id\":\"load-demo\"},on:{\"click\":_vm.load_demo}},[_vm._v(\"Load demo data\")])],1)],1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/@vue/cli-plugin-typescript/node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??clonedRuleSet-38.use[2]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Trends.vue?vue&type=script&lang=ts\"; export default mod; export * from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/@vue/cli-plugin-typescript/node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??clonedRuleSet-38.use[2]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Trends.vue?vue&type=script&lang=ts\"","import { render, staticRenderFns } from \"./Trends.vue?vue&type=template&id=7456416a&scoped=true&lang=pug\"\nimport script from \"./Trends.vue?vue&type=script&lang=ts\"\nexport * from \"./Trends.vue?vue&type=script&lang=ts\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"7456416a\",\n  null\n  \n)\n\nexport default component.exports","import _ from 'lodash';\nimport { split_by_hour_into_data } from '~/util/transforms';\nimport { getColorFromCategory } from '~/util/color';\nimport { useCategoryStore } from '~/stores/categories';\nexport function buildBarchartDataset(data_by_hour, classes) {\n    const SEP = '>>>';\n    const data = data_by_hour;\n    if (data) {\n        const category_names = new Set(Object.values(data)\n            .map(result => {\n            return result.cat_events.map(e => e.data['$category'].join(SEP));\n        })\n            .flat());\n        const ds = [...category_names]\n            .map(c_ => {\n            const categoryStore = useCategoryStore();\n            const c = categoryStore.get_category(c_.split(SEP));\n            if (c) {\n                const values = Object.values(data).map(results => {\n                    const cat = results.cat_events.find(e => _.isEqual(e.data['$category'], c.name));\n                    if (cat)\n                        return Math.round((cat.duration / (60 * 60)) * 1000) / 1000;\n                    else\n                        return null;\n                });\n                return {\n                    label: c.name.join(' > '),\n                    backgroundColor: getColorFromCategory(c, classes),\n                    data: values,\n                };\n            }\n            else {\n                // FIXME: This shouldn't happen\n                // This may for example happen if one doesn't have an 'Uncategorized' category,\n                // as can happen when one upgrades from an old version where there wasn't one in the default classes.\n                console.error('missing category:', c_);\n            }\n        })\n            .filter(x => x);\n        return ds;\n    }\n    else {\n        return [];\n    }\n}\nexport function buildBarchartDatasetActive(events_active) {\n    const data = split_by_hour_into_data(events_active);\n    return [\n        {\n            label: 'Total time',\n            backgroundColor: '#6699ff',\n            data,\n        },\n    ];\n}\n","import _ from 'lodash';\nimport moment from 'moment';\nimport { get_hour_offset } from '~/util/time';\n// TODO: Move somewhere else, possibly turn into a serverside transform\nexport function split_by_hour_into_data(events) {\n    if (events === undefined || events === null || events.length == 0)\n        return [];\n    const d = moment(events[0].timestamp).startOf('day');\n    const hoursOffset = get_hour_offset();\n    return _.range(0, 24).map(h => {\n        h += hoursOffset;\n        let duration = 0;\n        const d_start = d.clone().hour(h);\n        const d_end = d.clone().hour(h + 1);\n        // This can be made faster by not checking every event per hour, but since number of events is small anyway this and this is a lot shorter and easier to read it doesn't really matter.\n        events.map(e => {\n            const e_start = moment(e.timestamp);\n            const e_end = e_start.clone().add(e.duration, 'seconds');\n            if (e_start.isBetween(d_start, d_end) ||\n                e_end.isBetween(d_start, d_end) ||\n                d_start.isBetween(e_start, e_end)) {\n                if (d_start < e_start && e_end < d_end) {\n                    // If entire event is contained within the hour\n                    duration += e.duration;\n                }\n                else if (d_start < e_start) {\n                    // If start of event is within the hour, but not the end\n                    duration += (d_end.valueOf() - e_start.valueOf()) / 1000;\n                }\n                else if (e_end < d_end) {\n                    // If end of event is within the hour, but not the start\n                    duration += (e_end.valueOf() - d_start.valueOf()) / 1000;\n                }\n                else {\n                    // Happens if event covers entire hour and more\n                    duration += 3600;\n                }\n            }\n        });\n        return duration / 60 / 60;\n    });\n}\nexport function overlappingEvents(events1, events2) {\n    events1 = events1.sort((a, b) => a.timestamp - b.timestamp);\n    events2 = events2.sort((a, b) => a.timestamp - b.timestamp);\n    let i = 0;\n    let j = 0;\n    const overlapping = [];\n    while (i < events1.length && j < events2.length) {\n        const e1 = events1[i];\n        const e2 = events2[j];\n        // If `events1` and `events2` are the same list, we need to check if we are comparing the same event\n        if (events1 === events2 && e1 === e2) {\n            i++;\n            continue;\n        }\n        const e1_start = new Date(e1.timestamp);\n        const e2_start = new Date(e2.timestamp);\n        const e1_end = new Date(new Date(e1.timestamp).valueOf() + 1000 * e1.duration);\n        const e2_end = new Date(new Date(e2.timestamp).valueOf() + 1000 * e2.duration);\n        // Check for overlap\n        if (\n        // `e2.start` is within `e1`\n        (e1_start < e2_start && e2_start < e1_end) ||\n            // `e2.end` is within `e1`\n            (e1_start < e2_end && e2_end <= e1_end)) {\n            const overlap1 = {\n                start: e1_start,\n                end: e1_end,\n                event: e1,\n            };\n            const overlap2 = {\n                start: e2_start,\n                end: e2_end,\n                event: e2,\n            };\n            overlapping.push([overlap1, overlap2]);\n        }\n        // If `e2` ends after `e1`, advance `i`\n        if (e2.timestamp + 1000 * e2.duration > e1.timestamp + 1000 * e1.duration) {\n            i++;\n        }\n        else {\n            // Otherwise, advance `j`\n            j++;\n        }\n    }\n    if (overlapping.length > 0) {\n        console.warn('Overlapping events found', overlapping);\n    }\n    return overlapping;\n}\n"],"names":["render","_vm","this","_c","_self","staticClass","_v","_s","_f","timeperiod","attrs","bucketsStore","hosts","model","value","host","callback","$$v","expression","staticStyle","datasets","on","load_demo","staticRenderFns","name","props","data","today","get_today_with_offset","n_days","since","moment","subtract","useBucketsStore","categoryStore","useCategoryStore","activityStore","useActivityStore","start","length","computed","$route","params","buildBarchartDataset","category","by_period","classes","mounted","_mounted","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_context","prev","next","load","refresh","stop","apply","arguments","methods","_refresh","_callee2","force","queryParams","_context2","filter_afk","include_audible","filter_categories","dont_query_inactive","query_category_time_by_period","_x","_load_demo","_callee3","_context3","component","data_by_hour","SEP","category_names","Set","Object","values","map","result","cat_events","e","join","flat","ds","_toConsumableArray","c_","c","get_category","split","results","cat","find","_isEqual","Math","round","duration","label","backgroundColor","getColorFromCategory","console","error","filter","x","overlappingEvents","events1","events2","sort","a","b","timestamp","i","j","overlapping","e1","e2","e1_start","Date","e2_start","e1_end","valueOf","e2_end","overlap1","end","event","overlap2","push","warn"],"sourceRoot":""}